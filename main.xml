<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V1.0//EN"
"http://www.oasis-open.org/docbook/xml/simple/1.0/sdocbook.dtd">
<article>
  <title>JINR PAC руководство</title>
  <articleinfo>
    <date>Декабрь 1, 2018</date>
  </articleinfo>
  <section>
    <title>Основы работы спектрометра JINR PAC</title>
    <para>
      Таким образом при первоначальном включении спектрометра необходимо выполнить
      следующие процедуры для запуска накопления:
      <orderedlist>
	<listitem>
	  <para><link linkend='firmware_FPGA'>Загрузить прошивку в ПЛИС</link></para>
	</listitem>
	<listitem>
	  <para>Загрузить прошивку в USB контроллер</para>
	</listitem>
	<listitem>
	  <para>Провести инициализацию параметров ПЛИС</para>
	</listitem>
	<listitem>
	  <para>Задать параметры экспозиции</para>
	</listitem>
	<listitem>
	  <para>Провести запуск экспозиции</para>
	</listitem>
      </orderedlist>
      В том случае, если питание спектрометра не выключалось и процедуры прошивки и инициализации 
      были выполнены ранее, то первые три пункта можно пропустить.
    </para>
  </section>

  <section id='firmware_FPGA'>
    <title>Загрузка прошивки в ПЛИС</title>
    <para id="upload_firmware_FPGA_win">Загрузка прошивки в ПЛИС из ОС Windows XP</para>
	<orderedlist>
	  <listitem>
		<para>Запустите программу Impact</para>
	  </listitem>
	  <listitem>
		<para>Кликните дважды по Boundary Scan в окне программы в левом верхнем меню</para>
		<mediaobject>
		  <imageobject>
			<imagedata fileref='./imgs/firmware_FPGA_win_Bounddary_Scan.png'/>
		  </imageobject>
		</mediaobject>
	  </listitem>
	  <listitem>
		<para>Кликните правой кнопкой мыши для добавления устройства в поле Boundary Scan справа</para>
	  </listitem>
	  <listitem>
		<para>Выберите Initialize chain</para>
		<mediaobject>
		  <imageobject>
			<imagedata fileref='./imgs/firmware_FPGA_win_Add_device.png'/>
		  </imageobject>
		</mediaobject>
	  </listitem>
	  <listitem>
		<para>Выберите прошивку ПЛИС</para>
		<para>Одна из рабочих версий прошивки находится по адресу</para>
		<programlisting>
		  <![CDATA[E:/work/Proshivki/9253/Right/4poroga+count.bit]]>
		</programlisting>
		<para>В открывшемся окне кликните Ok</para>
	  </listitem>
	  <listitem>
		<para>Кликните правой кнопкой мыши на устройстве и выберите Program...</para>
		<mediaobject>
		  <imageobject>
			<imagedata fileref='./imgs/firmware_FPGA_win_Program.png'/>
		  </imageobject>
		</mediaobject>
	  </listitem>
	  <listitem>
		<para>В появившемся окне кликните Ok. После нескольких секунд прошивка ПЛИС будет завершена и в поле Boundary Scan появится надпись на синем фоне Program Succeded</para>
	  </listitem>
	  <listitem>
		<para>На этом процедура прошивки ПЛИС завершена. Программу Impact можно закрывать. Сохранять проект не надо.</para>
	  </listitem>
	</orderedlist>

    <para>Загрузка прошивки из ОС Linux</para>
    <orderedlist>
      <listitem>
	<para>Запустите Terminal</para>
      </listitem>
      <listitem>
	<para>Перейдите в каталог с пакетом програм Xilinx ISE:</para>
	<programlisting>
	  <![CDATA[cd ~/job/xilinx_soft/bin]]>
	</programlisting>
      </listitem>
      <listitem>
	<para>Запустите программу impact:</para>
	<programlisting>
	  <![CDATA[impact]]>
	</programlisting>
      </listitem>
      <listitem>
	<para>Далее последовательность действий <link linkend='upload_firmware_FPGA_win'>такая же как в Windows XP</link>.
	Иногда может потребоваться произвести поиск ПЛИС () два раза и/или переподключить USB кабель программатора ПЛИС к ПК.
	</para>
    </orderedlist>
  </section>

  <section id="firmware_USB">
    <title>Загрузка прошивки в USB контроллер</title>
    <para>Загрузка прошивки из OC Linux (с использованием графического интерфейса):</para>
    <orderedlist>
      <listitem>
	<para>Откройте Terminal</para>
      </listitem>
      <listitem>
		<para>Запустите программу Cypress USB control center командой:</para>
		<programlisting>
		  <![CDATA[cyusb_linux]]>
		</programlisting>
      </listitem>
      <listitem>
	<para>В Cypress USB control center выберите необходимый контроллер. Он должен иметь VID=04b4 и PID=8613</para>
      </listitem>
      <listitem>
		<para>Выберите вкладку Program, затем в списке Download to -> выберите пункт RAM, в списке Which RAM выберите пункт Internal</para>
      </listitem>
	  <listitem>
		<para>Нажмите на кнопку Select File и выберите необходимую прошивку USB контроллера</para>
		<para>Одна из прошивок находится по адресу:</para>
		<programlisting>
		  <![CDATA[/home/das/job/dsp/firmwares/512x4.hex]]>
		</programlisting>
      </listitem>
	  <listitem>
		<para>Произведите загрузку прошивки в контроллер нажатием кнопки Start Download</para>
		<para>В случае успешной прошивки появится диалоговое окно с текстом "Successfully downloaded"</para>
	  </listitem>
	  <listitem>
		<para>После прошивки контроллер необходимо перезагрузить путем нажатия кнопки Reset Device</para>
	  </listitem>
    </orderedlist>

    <para>Загрузка прошивки из OC Linux (с использованием интерфейса терминала):</para>
    <orderedlist>
      <listitem>
	<para>Откройте Terminal</para>
      </listitem>
      <listitem>
	<para>В терминале наберите следующую команду:</para>
	<programlisting>
	  <![CDATA[download_fx2 ...]]>
	</programlisting>
	<para>Эта команда запускает программу download_fx2, которая загружает прошивку 512x4.hex в USB контроллер с VID=04b4 и PID=8613</para>
      </listitem>
    </orderedlist>
  </section>
</article>
